(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function n(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=n(i);fetch(i.href,r)}})();class o{p1;p2;constructor(t,n){this.p1=t,this.p2=n}}class E{canvas;context;frameId=-1;fps_timestamp=-1;fps_interval;world;updateFn;constructor(t,n){this.canvas=t,this.context=this.canvas.getContext("2d",{alpha:!1});const s=window.devicePixelRatio,i=t.getBoundingClientRect();t.width=i.width*s,t.height=i.height*s,this.context.scale(s,s),t.style.width=`${i.width}px`,t.style.height=`${i.height}px`,this.world=n,this.fps_interval=1e3/60,this.updateFn=()=>{}}tick=()=>{this.frameId=requestAnimationFrame(this.tick);const t=Date.now(),n=t-this.fps_timestamp;n<this.fps_interval||(this.fps_timestamp=t-n%this.fps_interval,this.updateFn(),this.world.trace(),this.draw())};start(t){this.updateFn=t||this.updateFn,this.tick()}stop(){cancelAnimationFrame(this.frameId)}draw=()=>{const t=this.context,n=this.world;t.fillStyle="#fff",t.fillRect(0,0,800,600);for(const s of n.entities)this.drawEntity(s);t.fillStyle="green",t.beginPath(),t.ellipse(n.ray.origin.x,n.ray.origin.y,10,10,Math.PI/4,0,360),t.fill(),this.drawTraces(n)};drawTraces(t){if(t.traced.length===1)return;const n=this.context;let s=t.traced[0];for(let i=1;i<t.traced.length;i++){const r=t.traced[i];n.strokeStyle="black",n.beginPath(),n.setLineDash([3,3]),n.moveTo(s.x,s.y),n.lineTo(r.x,r.y),n.stroke(),n.fillStyle=i===t.traced.length-1?"red":"blue",n.beginPath(),n.ellipse(r.x,r.y,6,6,Math.PI/4,0,360),n.fill(),s=r}}drawEntity(t){const n=this.context,s=t instanceof o?[t.p1,t.p2]:t.lines.flatMap(i=>[i.p1,i.p2]);n.beginPath(),n.setLineDash([]),n.strokeStyle="black",n.lineWidth=1,n.moveTo(s[0].x,s[0].y);for(let i=1;i<s.length;i++)n.lineTo(s[i].x,s[i].y);n.stroke()}}class e{x;y;constructor(t,n){this.x=t,this.y=n}add(t){return new e(this.x+t.x,this.y+t.y)}sub(t){return new e(this.x-t.x,this.y-t.y)}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}scale(t){return new e(this.x*t,this.y*t)}length(){return Math.hypot(this.x,this.y)}normalize(){const t=this.length();return t===0?new e(0,0):this.scale(1/t)}perpendicular(){return new e(-this.y,this.x)}negate(){return new e(-this.x,-this.y)}rotate(t){const n=Math.cos(t),s=Math.sin(t);return new e(this.x*n-this.y*s,this.x*s+this.y*n)}}class m{lines;center;constructor(t,n){const s=n/2|0;this.center=t,this.lines=[new o(new e(t.x-s,t.y-s),new e(t.x+s,t.y-s)),new o(new e(t.x+s,t.y-s),new e(t.x+s,t.y+s)),new o(new e(t.x+s,t.y+s),new e(t.x-s,t.y+s)),new o(new e(t.x-s,t.y+s),new e(t.x-s,t.y-s))]}rotate(t){const n=this.center;for(const s of this.lines)s.p1=s.p1.sub(n).rotate(t).add(n),s.p2=s.p2.sub(n).rotate(t).add(n);return this}}class P{origin;direction;constructor(t,n){this.origin=t,this.direction=n.normalize()}intersect(t){const n=this.origin,s=this.direction,i=t.p1,c=t.p2.sub(i),l=s.cross(c);if(l===0)return null;const h=i.sub(n),g=h.cross(c)/l,w=h.cross(s)/l;return g>=0&&w>=0&&w<=1?n.add(s.scale(g)):null}reflect(t){const n=this.direction.dot(t);return this.direction.sub(t.scale(2*n)).normalize()}}class F{world;constructor(t){this.world=t}cast(t,n=10){let s=t;const i=[t.origin];for(let r=0;r<n;r++){let c=null,l=null,h=1/0;for(let p of this.world.entities)if(p instanceof o){const u=s.intersect(p);if(u){const f=u.sub(s.origin).length();f<h&&(h=f,c=u,l=p)}}else if(p instanceof m)for(const u of p.lines){const f=s.intersect(u);if(f){const b=f.sub(s.origin).length();b<h&&(h=b,c=f,l=u)}}if(!c||!l)break;i.push(c);let w=l.p2.sub(l.p1).normalize().perpendicular().normalize();w.dot(s.direction)>0&&(w=w.negate());const x=s.reflect(w);s=new P(c.add(x.scale(.01)),x)}return i}}class S{entities=[];ray;casting;traced=[];limit;constructor(){this.entities=[],this.ray=new P(new e(400,300),new e(-.5,-.9)),this.casting=new F(this),this.limit=5}add(t){return this.entities.push(t),this}trace(){this.traced=this.casting.cast(this.ray,this.limit)}}const y=document.getElementById("app");if(!y)throw new Error("No canvas element found");const d=new S;window.world=d;const q=new o(new e(1,1),new e(799,1)),z=new o(new e(1,599),new e(799,599)),D=new o(new e(1,1),new e(1,599)),M=new o(new e(799,1),new e(799,599));d.add(q);d.add(z);d.add(D);d.add(M);d.add(new o(new e(40,40),new e(300,20))).add(new o(new e(300,20),new e(500,30))).add(new o(new e(500,30),new e(750,10))).add(new o(new e(750,10),new e(790,250))).add(new o(new e(790,250),new e(750,300))).add(new o(new e(750,300),new e(790,350))).add(new o(new e(790,350),new e(780,590))).add(new o(new e(780,590),new e(600,550))).add(new o(new e(600,550),new e(400,560))).add(new o(new e(400,560),new e(200,595))).add(new o(new e(200,595),new e(190,500))).add(new o(new e(190,500),new e(150,595))).add(new o(new e(150,595),new e(30,490))).add(new o(new e(30,490),new e(50,290))).add(new o(new e(50,290),new e(10,140))).add(new o(new e(10,140),new e(40,40)));const L=new m(new e(250,250),75),I=new m(new e(450,450),90),v=new m(new e(550,200),90);d.add(L).add(I).add(v);y.addEventListener("mousemove",a=>{const t=y.getBoundingClientRect(),n=a.clientX-t.left-400,s=a.clientY-t.top-300;d.ray.direction=new e(n,s).normalize()});document.getElementById("limit")?.addEventListener("input",a=>{const t=a.target,n=parseInt(t.value,10);isNaN(n)||(d.limit=n)});const R=new E(y,d);R.start(()=>{L.rotate(.002),I.rotate(-.005),v.rotate(.002)});
