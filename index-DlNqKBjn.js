class t{canvas;emitter;state=new Map;x=0;y=0;constructor(t,e){this.canvas=t,this.emitter=e}onKeyDown=t=>{this.state.set(t.code,!0)," "===t.key&&this.emitter.emit("space")};onKeyUp=t=>{this.state.set(t.code,!1)};onMouseMove=t=>{const e=this.canvas.getBoundingClientRect();this.x=t.clientX-e.left,this.y=t.clientY-e.top};onMouseDown=t=>{0===t.button?this.emitter.emit("mouseDownLeft"):2===t.button&&this.emitter.emit("mouseDownRight")};onMouseUp=t=>{0===t.button?this.emitter.emit("mouseUpLeft"):2===t.button&&this.emitter.emit("mouseUpRight")};onContextMenu=t=>{t.preventDefault()};init(){window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp),window.addEventListener("mousedown",this.onMouseDown),window.addEventListener("mouseup",this.onMouseUp),window.addEventListener("contextmenu",this.onContextMenu),this.canvas.addEventListener("mousemove",this.onMouseMove)}dispose(){window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp),window.removeEventListener("mousedown",this.onMouseDown),window.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("contextmenu",this.onContextMenu),this.canvas.removeEventListener("mousemove",this.onMouseMove)}}class e{listeners={};on(t,e){return this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(e),()=>{this.off(t,e)}}emit(t,...e){if(this.listeners[t])for(const s of this.listeners[t])s(...e)}off(t,e){this.listeners[t]&&(this.listeners[t]=this.listeners[t].filter(t=>t!==e))}}class s{g;c;i;f;sx;sy;w;h;timer;index;finished=!1;constructor(t,e,s,i,n,r,h,o){this.g=r??0,this.c=n??1,this.i=h??1/0,this.f=o??1===this.c,this.sx=t,this.sy=e,this.w=s,this.h=i,this.timer=0,this.index=0}get x(){return this.sx+this.index*(this.w+this.g)}get y(){return this.sy}reset(){this.timer=0,this.index=0,this.finished=!1}update(t){this.timer+=t,this.timer<this.i||this.finished||(this.timer=0,this.index=this.index+1,this.index>=this.c&&(this.f?(this.index=this.c-1,this.finished=!0):this.index=0))}}class i{x;y;constructor(t,e){this.x=t,this.y=e}static radian(t){return new i(Math.sin(t),Math.cos(t)).norm()}static random(){return new i(2*Math.random()-1,2*Math.random()-1).norm()}add(t){return new i(this.x+t.x,this.y+t.y)}sub(t){return new i(this.x-t.x,this.y-t.y)}equal(t){return this.x===t.x&&this.y===t.y}empty(){return this.equal(new i(0,0))}scale(t){return new i(this.x*t,this.y*t)}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}len(){return Math.hypot(this.x,this.y)}norm(){const t=this.len();return 0!==t?new i(this.x/t,this.y/t):new i(0,0)}normal(t){const e=t.sub(this);return new i(-e.y,e.x).norm()}dist(t){return this.sub(t).len()}clone(){return new i(this.x,this.y)}perpendicular(){return new i(-this.y,this.x)}negate(){return this.scale(-1)}reflect(t){return this.sub(t.scale(2*this.dot(t)))}rotate(t){const e=Math.cos(t),s=Math.sin(t);return new i(this.x*e-this.y*s,this.x*s+this.y*e)}}class n{resource;frames;localCanvas;localContext;hi=!1;vi=!1;rotation=0;type;frame;constructor(t,e){this.resource=t,this.frames={};for(const[n,r]of Object.entries(e))this.frames[n]=new s(...r);const i=Object.keys(e)[0];this.type=i,this.frame=this.frames[i],this.localCanvas=document.createElement("canvas"),this.localCanvas.width=this.frame.w,this.localCanvas.height=this.frame.h,this.localContext=this.localCanvas.getContext("2d",{alpha:!0}),this.localContext.imageSmoothingEnabled=!1}play(t){t!==this.type&&(this.type=t,this.frame=this.frames[t],this.frame.reset())}update(t){this.frame.update(t)}rotate(t){this.rotation=Math.atan2(t.y,t.x)}draw(t,e,s,i,n){if(!this.frame)return;const r=this.frame,h=i??r.w,o=n??r.h;this.localCanvas.width=h,this.localCanvas.height=o;const a=this.localContext;a.imageSmoothingEnabled=!1,a.clearRect(0,0,h,o),a.save(),a.translate(h/2|0,o/2|0),a.rotate(this.rotation),this.hi&&this.vi?a.scale(-1,-1):this.hi?a.scale(-1,1):this.vi&&a.scale(1,-1),a.drawImage(this.resource.img,r.x,r.y,r.w,r.h,-h/2|0,-o/2|0,h,o),a.restore(),t.drawImage(this.localCanvas,e-h/2|0,s-o/2|0)}}function r(t,e,s,i){const n=i.sub(s),r=t.sub(s),h=Math.max(0,Math.min(1,r.dot(n)/n.dot(n))),o=s.add(n.scale(h));return t.dist(o)<=e}function h(t,e,s){return t.dist(s)<=e}class o{p;d;game;speed;sprite;angle=0;c=0;constructor(t,e,s,i=4){this.p=t,this.d=e,this.game=s,this.speed=i,this.sprite=this.game.sprites.ball,this.sprite.play("run"),this.sprite.rotate(e)}update(t){const e=this.game.scene;if(!e)return;this.sprite.update(t),this.speed<1.5?this.speed*=.992:this.speed*=.9985;const s=this.p.add(this.d.scale(this.speed));let i=!1;for(const n of e.allEntities)for(const[t,e]of n.lines){if(r(s,4,t,e)){const s=t.normal(e);this.d=this.d.reflect(s).norm(),i=!0}if(h(s,4,t)||h(s,4,e)){const e=s.sub(t).norm();this.d=this.d.reflect(e).norm(),i=!0}}i?(this.speed>.25&&this.game.sound.playEffect("blip"),this.speed*=.95,this.p=this.p.add(this.d.scale(this.speed))):this.p=s,this.c+=1,10===this.c&&(this.c=0,this.speed>.5&&(this.angle=(this.angle+1)%4))}draw(t){const e=this.p.x,s=this.p.y;t.save(),t.translate(e,s+6+2),t.scale(1,.6);const i=t.createRadialGradient(0,0,0,0,0,12);i.addColorStop(0,"rgba(0,0,0,0.25)"),i.addColorStop(1,"rgba(0,0,0,0)"),t.fillStyle=i,t.beginPath(),t.ellipse(0,0,12,4,0,0,2*Math.PI),t.fill(),t.restore();const n=this.angle*(Math.PI/2),r=2.5*Math.cos(n),h=2.5*Math.sin(n),o=t.createRadialGradient(e+r,s+h,0,e,s,6);o.addColorStop(0,"#ffffff"),o.addColorStop(.25,"#c67575ff"),o.addColorStop(.55,"#781f1fff"),o.addColorStop(1,"#bd2020ff"),t.fillStyle=o,t.beginPath(),t.arc(e,s,6,0,2*Math.PI),t.fill(),t.fillStyle="rgba(255,255,255,0.85)",t.beginPath(),t.arc(e+r,s+h,1,0,2*Math.PI),t.fill()}}class a{game;ball;constructor(t){this.game=t,this.ball=new o(new i(440,44),new i(0,0),t,0)}draw(t){const e=(this.game.scene.timeLeft/1e3).toFixed(0);t.fillStyle="#000000",t.fillRect(430,0,200,60),t.font="16px monospace",t.fillStyle="#ffffff",t.fillText(`Time left: ${e}s`,430,20),this.ball.draw(t),t.fillStyle="#ffffff",t.fillText(`: ${this.game.player?.balls??0}`,450,49),this.game.sprites.ball}}class l{p;w;h;s;hp;d;game;constructor(t,e,s,n,r,h){this.p=t,this.w=e,this.h=s,this.s=n,this.hp=r,this.game=h,this.d=new i(0,0)}wouldCollide(t){const e=this.game.scene;if(!e)return!1;for(const s of e.allEntities)if(s.intersect(t,Math.max(this.w,this.h)))return!0;return!1}update(t=!1){if(0===this.s)return;const e=this.d.scale(this.s),s=this.p.add(new i(e.x,0)),n=this.p.add(new i(0,e.y)),r=this.p.add(e);if(t)if(this.wouldCollide(r)){let t=!1;this.wouldCollide(s)||(this.p=s,t=!0),this.wouldCollide(n)||(this.p=n,t=!0),t||(this.p=this.p)}else this.p=r;else this.wouldCollide(r)||(this.p=r)}}class c{c;sprite;game;balls=0;isAttacking=!1;constructor(t,e){this.game=e,this.c=new l(t,16,16,2.5,100,e),this.sprite=this.game.sprites.cat}init(){this.game.emitter.on("mouseDownLeft",this.attack),this.game.emitter.on("mouseDownRight",this.throw)}dispose(){this.game.emitter.off("mouseDownLeft",this.attack),this.game.emitter.off("mouseDownRight",this.throw)}attack=()=>{if(!this.isAttacking){this.sprite.play("attack"),this.game.sound.playEffect("hit"),this.isAttacking=!0;const t=this.game.scene?.rats??[];for(const e of t)this.c.p.dist(e.c.p)<30&&(e.c.hp-=25)}};throw=()=>{const t=this.game.scene;if(!t)return;if(0===this.balls)return;this.balls-=1,this.game.sound.playEffect("shoot");const e=this.game.control.y,s=this.game.control.x,n=new i(s,e).sub(this.c.p).norm();t.projectiles.push(new o(this.c.p,n,this.game))};update(t){this.updateDirection(),this.updateCharacter(t),this.c.update(!0)}updateDirection(){const t=this.game.control;let e=new i(0,0);t.state.get("KeyW")&&(e=e.add(new i(0,-1))),t.state.get("KeyS")&&(e=e.add(new i(0,1))),t.state.get("KeyA")&&(e=e.add(new i(-1,0))),t.state.get("KeyD")&&(e=e.add(new i(1,0))),this.c.d=e.norm()}updateCharacter(t){const e=this.game.scene;if(!e)return;let s="idle";this.isAttacking?this.sprite.frame.finished?(this.isAttacking=!1,s=this.c.d.empty()?"idle":"run"):s="attack":s=this.c.d.empty()?"idle":"run",this.sprite.play(s),this.c.d.x<0?this.sprite.hi=!0:this.c.d.x>0&&(this.sprite.hi=!1);for(let i=0;i<e.projectiles.length;i++){const t=e.projectiles[i];t.p.dist(this.c.p)<=Math.max(2*this.c.w,2*this.c.h)&&t.speed<3&&(e.projectiles.splice(i,1),i-=1,this.game.sound.playEffect("pickup"),this.balls+=1)}this.sprite.update(t)}draw(t){const e=this.c.p;this.sprite.draw(t,e.x,e.y,4*this.sprite.frame.w,4*this.sprite.frame.h),this.game.scene?._debug&&(t.fillStyle="red",t.beginPath(),t.ellipse(e.x,e.y,3,3,Math.PI/4,0,360),t.fill(),t.closePath())}}class p{canvas;context;frameId=-1;fps_timestamp=-1;fps_interval;scene;constructor(t){this.canvas=t,this.context=this.canvas.getContext("2d",{alpha:!1,willReadFrequently:!0});const e=window.devicePixelRatio,s=t.getBoundingClientRect();t.width=s.width*e,t.height=s.height*e,this.context.scale(e,e),t.style.width=`${s.width}px`,t.style.height=`${s.height}px`,this.context.imageSmoothingEnabled=!1,this.fps_interval=1e3/60}tick=()=>{this.frameId=requestAnimationFrame(this.tick);const t=Date.now(),e=t-this.fps_timestamp;e<this.fps_interval||(this.fps_timestamp=t-e%this.fps_interval,this.scene&&(this.scene.update(e),this.scene.draw(this.context)))};start(){this.tick()}stop(){cancelAnimationFrame(this.frameId)}}const d=32,u=768,f=576,w=384,m=288,g=t=>{t.font="16px monospace",t.fillStyle="#4d4343",t.fillText("[Press space to skip]",w,512)},y=(t,e,s=100)=>{const i=t.map(t=>function(t){const s=t.split(" "),i=[];let n="";for(const r of s)n.length+r.length+1>e?(i.push(n),n=r):n+=(0===n.length?"":" ")+r;n&&i.push(n);return i}(t));let n=0,r=0,h=0,o=!1,a=!1,l=0;return function(){if(o)return{done:!0,lines:i[i.length-1]};n+=.18;const e=t[r];h=Math.min(Math.floor(n),t[r].length);const c=function(t,e){let s=0;const i=[];for(const n of t){if(!(s+n.length<e-1)){i.push(n.substr(0,e-s));break}i.push(n),s+=n.length}return i}(i[r],h);return a&&(l+=1),h>=e.length&&!a&&(a=!0,l=0),a&&l===s&&(r++,n=0,h=0,a=!1,l=0),r>=t.length&&(o=!0),{done:o,lines:c}}};class b{sceneDraw;interactive;entities=[];objects2D=[];projectiles=[];rats=[];gameTime=0;timeLeft=0;game;_debug=!1;constructor(t,e=!0,s=0){this.sceneDraw=t,this.gameTime=s,this.interactive=e}*gen(){for(const t of this.entities)yield t;for(const t of this.objects2D)t.entity&&(yield t.entity)}get allEntities(){return[...this.gen()]}update(t){if(this.interactive){if(this.timeLeft=(this.game?.scene.gameTime??0)-(Date.now()-(this.game?.startTime??0)),this.timeLeft<=0)return this.game?.setScene("gameover"),void this.game?.sound.stopMusic();this.game?.player?.update(t);for(const e of this.entities)e.update(t);for(const e of this.objects2D)e.update(t);for(const e of this.projectiles)e.update(t);for(let e=0;e<this.rats.length;e++)this.rats[e].update(t),this.rats[e].c.hp<=0&&(this.rats.splice(e,1),e-=1,this.game?.sound.playEffect("death"))}}draw(t){if(this.sceneDraw(t),this.interactive){this.game?.panel?.draw(t);for(const e of this.objects2D)e.draw(t),this._debug&&e.entity?.draw(t);for(const e of this.projectiles)e.draw(t);for(const e of this.rats)e.draw(t);if(this.game?.player?.draw(t),this._debug)for(const e of this.entities)e.draw(t)}}}const x=t=>{const e=new b(t=>{t.fillStyle="#000000",t.fillRect(0,0,u,f),t.strokeStyle="#ffffff",t.strokeRect(288,256,d,d),t.strokeRect(288,296,d,d),t.strokeRect(328,296,d,d),t.strokeRect(248,296,d,d),t.fillStyle="#fff",t.textBaseline="top",t.textAlign="center",t.font="14px monospace",t.fillText("W",304,264),t.fillText("S",304,304),t.fillText("A",264,304),t.fillText("D",344,304),t.strokeRect(434,238,30,50),t.strokeRect(464,238,30,50),t.strokeRect(434,238,60,125),t.fillText("Attack",424,213),t.fillText("Throw",504,213),g(t)},!1);return setTimeout(()=>{t.order<1&&t.nextScene()},5e3),e},v=t=>{const e=y(["They say black cat brings bad luck","But today the black cat is unlucky","There are rats in the house. Get rid of them before the owners come.","Don't let your reputation be ruined or you'll be thrown out of the house"],24);let s=-1;return new b(i=>{i.fillStyle="#000000",i.fillRect(0,0,u,f);const{lines:n,done:r}=e();r&&-1===s&&(s=setTimeout(()=>{t.order<2&&t.nextScene()},2e3)),i.fillStyle="#fff",i.textBaseline="top",i.textAlign="center",i.font="24px monospace";let h=0;for(const t of n)i.fillText(t,w,256+h),h+=d;i.fill(),g(i)},!1)};const M=t=>{const e=y(["ACT 1","Kitchen"],8,250);let s=-1;const i=function(t=100){let e=0;return function(){e>t&&(e=t);const s=Math.round(e/t*255).toString(16).padStart(2,"0");return e++,`#${s}0000`}}(500);return new b(n=>{n.fillStyle="#000000",n.fillRect(0,0,u,f);const{lines:r,done:h}=e();h&&-1===s&&(s=setTimeout(()=>{t.order<3&&t.nextScene()},1e3)),n.fillStyle=i(),n.textBaseline="top",n.textAlign="center",n.font="24px monospace";let o=0;for(const t of r)n.fillText(t,w,256+o),o+=d;n.fill(),g(n)},!1)};class S{p;vs;color;constructor(t,e,s={color:"#000"}){this.p=t,this.vs=e,this.color=s.color}static line(t,e,s){return new S(t,[e,s])}static square(t,e){const s=e/2|0;return new S(t,[new i(-s,-s),new i(s,-s),new i(s,s),new i(-s,s)])}static polygon(t,e,s="#fff"){return new S(t,e.map(([t,e])=>new i(t,e)),{color:s})}*gen(){for(let t=1;t<this.vs.length;t++)yield[this.vs[t-1].add(this.p),this.vs[t].add(this.p)];yield[this.vs[this.vs.length-1].add(this.p),this.vs[0].add(this.p)]}get lines(){return[...this.gen()]}rotate(t){const e=Math.atan2(t.y,t.x);for(let s=0;s<this.vs.length;s++)this.vs[s]=this.vs[s].rotate(e)}move(t){this.p=this.p.add(t)}static lineIntersect(t,e,s){const[i,n]=e,r=n.sub(i),h=t.sub(i),o=r.dot(r);if(0===o)return t.sub(i).len()<=s;const a=h.dot(r)/o,l=Math.max(0,Math.min(1,a)),c=i.add(r.scale(l));return t.sub(c).len()<=s}intersect(t,e=0){for(const s of this.lines)if(S.lineIntersect(t,s,e))return s;return null}draw(t){t.beginPath(),t.setLineDash([]),t.strokeStyle=this.color,t.lineWidth=1;const e=this.vs[0].add(this.p);t.moveTo(e.x,e.y);for(let s=0;s<this.vs.length;s++){const e=this.vs[s].add(this.p);t.lineTo(e.x,e.y)}t.lineTo(e.x,e.y),t.stroke()}update(t){}}class k{position;scale;entity;sprite;frame;finite;hb;hi;vi;constructor(t,e,s,n,r={}){if(this.position=new i(t[0],t[1]),this.sprite=s,this.scale=e,this.frame=n,this.hb=r.hb??!0,this.hi=r.hi??!1,this.vi=r.vi??!1,this.finite=this.sprite.frame.f,this.hb){const t=this.width/2|0,e=this.height/2|0;this.entity=S.polygon(this.position,[[-t,-e],[t,-e],[t,e],[-t,e]],"red")}this.sprite.play(this.frame)}get width(){return this.sprite.frame.w*this.scale}get height(){return this.sprite.frame.h*this.scale}update(t){this.finite||this.sprite.update(t)}draw(t){this.sprite.hi=this.hi,this.sprite.vi=this.vi,this.sprite.draw(t,this.position.x,this.position.y,this.width,this.height)}}class C{game;c;counter=0;current=0;sprite;cooldown=0;cooldownCounter=0;state="run";constructor(t,e){this.game=e,this.c=new l(new i(t[0],t[1]),10,10,2.8,100,e),this.sprite=new n(e.resources.rat,{run:[8,86,16,10,10,16,200,!1],death:[8,150,16,10,10,16,100,!0]}),this.c.d=i.random(),this.state="run",this.sprite.play("run"),this.setCounter()}setCounter(){this.current=0,this.counter=150+Math.floor(400*Math.random())}update(t){const e=this.game.scene;if(!e)return;const s=this.c.p.clone();if(this.current+=1,this.current===this.counter&&(this.c.d=i.random(),this.setCounter()),"caught"===this.state&&(this.cooldownCounter+=1),this.cooldownCounter===this.cooldown&&(this.state="run",this.sprite.play("run")),"run"===this.state){for(this.c.update();this.c.p.equal(s);)this.c.d=i.random(),this.c.update();for(const t of e.projectiles){const e=t.p.dist(this.c.p);if("run"===this.state&&e<=16&&t.speed>2){this.state="caught",this.sprite.play("death"),this.game.sound.playEffect("stun"),this.cooldown=250,this.cooldownCounter=0,this.c.hp-=10;break}}}this.c.d.x<0?this.sprite.hi=!1:this.c.d.x>0&&(this.sprite.hi=!0),this.sprite.update(t)}draw(t){const e=this.c.p.x,s=this.c.p.y;this.sprite.draw(t,e,s,32,20),t.beginPath(),t.fillStyle="red",t.rect(e-10,s-24,32,4),t.fill(),t.closePath(),t.beginPath(),t.fillStyle="green",t.rect(e-10,s-24,this.c.hp/100*32,4),t.fill(),t.closePath(),this.game.scene?._debug&&(t.fillStyle="red",t.beginPath(),t.ellipse(this.c.p.x,this.c.p.y,3,3,Math.PI/4,0,360),t.fill(),t.closePath())}}const P=t=>{const e=new b(t=>{t.fillStyle="#b0b897",t.fillRect(d,192,704,352),t.fillStyle="#545046",t.beginPath(),t.rect(0,0,d,f),t.rect(0,0,w,d),t.rect(w,0,d,64),t.rect(0,544,u,f),t.rect(w,64,w,d),t.rect(736,64,d,512),t.fill(),t.closePath(),t.beginPath(),t.fillStyle="#6e6244",t.rect(d,d,352,160),t.fill(),t.closePath(),t.beginPath(),t.fillStyle="#445216",t.rect(w,96,352,160),t.fill(),t.closePath(),t.beginPath(),t.fillStyle="#a6b379";for(let e=0;e<22;e++)t.rect(w+e*d/2,96,8,164);t.fill(),t.closePath(),t.beginPath(),t.fillStyle="#ffffff",t.rect(d,192,352,8),t.rect(d,192,8,352),t.rect(d,536,704,8),t.rect(376,192,8,72),t.rect(376,256,352,8),t.rect(728,256,8,m),t.fill(),t.closePath()},!0,6e4),s=!1;return e.objects2D=[new k([184,112],5,t.sprites.kitchen,"kitchen",{hb:s}),new k([264,152],5,t.sprites.wash,"wash",{hb:s}),new k([400,112],5,t.sprites.fridge,"fridge",{hb:s}),new k([192,320],4,t.sprites.table,"table"),new k([96,472],4,t.sprites.plant,"plant"),new k([576,176],4,t.sprites.window,"window",{hb:s}),new k([640,176],4,t.sprites.window,"window",{hb:s}),new k([168,352],4,t.sprites.chair2,"chair2"),new k([216,352],4,t.sprites.chair2,"chair2"),new k([448,192],4,t.sprites.door,"door",{hb:s}),new k([608,296],4,t.sprites.table,"table"),new k([608,280],4,t.sprites.tv,"tv",{hb:s}),new k([584,448],4,t.sprites.chair,"chair",{hb:s}),new k([632,448],4,t.sprites.chair,"chair",{hb:s}),new k([w,480],4,t.sprites.stable,"stable"),new k([w,472],2,t.sprites.lamp,"lamp",{hb:s})],e.projectiles=[new o(new i(56,516),new i(0,0),t,0),new o(new i(700,290),new i(0,0),t,0),new o(new i(w,352),new i(0,0),t,0)],e.rats=[new C([340,340],t),new C([340,340],t),new C([340,340],t),new C([80,280],t),new C([80,280],t),new C([80,280],t),new C([700,500],t),new C([700,500],t),new C([700,500],t)],e.entities=[S.polygon(new i(384,360),[[-344,-160],[-8,-160],[-8,-96],[344,-96],[344,176],[-344,176]],"red"),S.polygon(new i(608,448),[[-50,-25],[50,-25],[50,25],[-50,25]],"red")],e},D=t=>{const e=y(["You failed to fulfill your duties.","The game is over."],25),s=new b(s=>{if(s.fillStyle="#000000",s.fillRect(0,0,u,f),n=h?Math.max(0,n-2):Math.min(200,Math.max(5,n+2)),0===n&&(o=!0),s.fillStyle="#540d0d",s.beginPath(),s.ellipse(w,m,n,n,Math.PI/4,0,360),s.fill("evenodd"),s.closePath(),a.position.x>w?a.position=a.position.add(new i(-1,0)):(a.sprite.play("idle"),r||(r=!0,t.sound.playEffect("jump"))),r&&(l.position=l.position.add(new i(-1,-.5).scale(5))),l.position.x<100&&(h=!0),n>40&&(a.update(16),a.draw(s)),o){const{lines:t}=e();s.fillStyle="#861d1d",s.textBaseline="top",s.textAlign="center",s.font="24px monospace";let i=0;for(const e of t)s.fillText(e,w,256+i),i+=d;s.fill()}l.update(16),l.draw(s)},!1);let n=5,r=!1,h=!1,o=!1;const a=new k([518,m],2,t.sprites.granny,"run"),l=new k([334,303],4,t.sprites.cat,"idle");return s.objects2D=[a,l],s};class T{musicNode;effects={hit:[,,348,.01,.04,.07,,.3,-6,-14,,,,.9,,.1,,.51,.02,,107],stun:[1.5,,152,,.08,.17,1,.2,-2,,,,,.6,,.2,.08,.92,.02],shoot:[,,79,.01,.04,.06,1,.6,19,-38,,,,,,,,.63,.07],pickup:[,,398,.02,.02,.07,1,1.2,,,208,.06,,,,,,.83,.03],jump:[,,399,.03,.04,,1,2,4,,,,,,,,,.68,.02],blip:[1.1,,207,.02,.02,.04,,1.6,,,267,.28,,.2,133,,,.71,.02],death:[2,,311,.01,.01,.07,,.5,1,14,,,,,,.2,.27,.78,.08,,414]};music={main:[[[.2,0,77,,,.7,2,.41,,,,,,,,.06],[.2,0,43,.01,,.3,2,,,,,,,,,.02,.01],[.2,0,170,.003,,.008,,.97,-35,53,,,,,,.1],[.4,0,270,,,.12,3,1.65,-2,,,,,4.5,,.02],[.2,0,86,,,,,.7,,,,.5,,6.7,1,.05],[.2,0,41,,.05,.4,2,0,,,9,.01,,,,.08,.02],[.2,0,2200,,,.04,3,2,,,800,.02,,4.8,,.01,.1],[.3,0,16,,,.3,3]],[[[1,-1,21,21,33,21,21,33,21,21,33,21,21,33,21,21,33,33,21,21,33,21,21,33,21,21,33,21,21,33,21,21,33,33,21,21,33,21,21,33,21,21,33,21,21,33,21,21,33,33,21,21,33,21,21,33,21,21,33,21,21,33,21,21,33,33],[3,1,22,,,,,,,,,,,,,,,,,,,,,,,,,,,,24,,,,24,,,,,,,,,,,,,,,,,,,,,,,,22,,22,,22,,,,],[5,-1,21,,,,,,,,,,,,,,,,,,,,,,,,,,,,24,,,,23,,,,,,,,,,,,,,,,,,,,,,,,24,,23,,21,,,,],[,1,21,,,,,,,,,,,,,,,,,,,,,,,,,,,,24,,,,23,,,,,,,,,,,,,,,,,,,,,,,,24,,23,,21,,,,]],[[1,-1,21,21,33,21,21,33,21,21,33,21,21,33,21,21,33,33,21,21,33,21,21,33,21,21,33,21,21,33,21,21,33,33,21,21,33,21,21,33,21,21,33,21,21,33,21,21,33,33,21,21,33,21,21,33,21,21,33,21,21,33,21,21,33,33],[3,1,24,,,,,,,,27,,,,,,,,,,,,,,,,27,,,,24,,,,24,,,,,,,,27,,,,,,,,,,,,,,,,24,,24,,24,,,,],[5,-1,21,,,,,,,,,,,,,,,,,,,,,,,,,,,,24,,,,23,,,,,,,,,,,,,,,,,,,,,,,,24,,23,,21,,,,],[,1,21,,,,,,,,,,,,,,,,,,,,,,,,,,,,24,,,,23,,,,,,,,,,,,,,,,,,,,,,,,24,,23,,21,,,,],[6,1,,,34,34,34,,,,,,34,34,,,,,34,,,,34,34,,,,,34,,,,34,,,,34,34,34,,,,,,34,,,,,,34,34,,,34,34,,,,,,,,,34,34],[4,1,,,,,,,24,,,,,,24,,24,,,,24,,,,24,,,,,,,,,,,,,,,,24,,,,,,24,,24,,,,24,,,,24,,,,,,,,,,]],[[1,-1,21,21,33,21,21,33,21,21,33,21,21,33,21,21,33,33,21,21,33,21,21,33,21,21,33,21,21,33,21,21,33,33,23,23,35,23,23,36,23,23,35,23,23,36,23,23,35,35,23,23,35,23,23,35,23,23,36,23,23,35,23,23,36,36],[5,-1,21,,,19,,,21,,,,,,,,,,21,,,19,,,17,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,],[3,1,24,,,24,,,24,,,,,,,,,,24,,,24,,,24,,,,24.75,24.5,24.26,24.01,24.01,24.01,,,,,25,,,,,,,,25,,,,,,,,25,,,,,,,,25,25,25,25],[4,-1,,,,,,,,,,,,,,,,,,,,,,,,,,,24.75,24.5,24.26,24.01,24.01,24.01,24.01,24,,24,24,,24,24,24,24,,24,24,,24,,24,24,,24,24,,24,24,24,24,,24,24,,24,24],[7,-1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,23,,21,23,,35,,23,,21,23,,35,,35,,23,,21,23,,35,,21,23,,35,,21,23,,,],[6,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,34,36,34,,33,34,34,36,31,36,34,,31,34,32,,33,36,34,,31,34,34,36,33,36,33,,31,,,]],[[1,-1,21,21,33,21,21,33,21,21,33,21,21,33,21,21,33,33,21,21,33,21,21,33,21,21,33,21,21,33,21,21,33,33,17,17,29,17,17,29,17,17,29,17,17,29,17,17,29,29,17,17,29,17,17,29,17,17,29,17,17,29,17,17,29,29],[4,1,24,24,,24,24,,24,24,24,24,,24,24,,24,,24,24,,24,24,,24,24,24,24,,24,24,,24,24,24,24,,24,24,,24,24,24,,,24,24,,24,,24,24,,24,24,,24,24,24,24,,24,24,,24,24],[7,-1,21,,19,21,,33,,21,,19,21,,33,,33,,21,,19,21,,33,,21,,19,21,,33,,33,,17,,17,17,29,17,17,29,17,,17,17,29,17,17,29,17,,17,17,29,17,17,29,17,,17,17,29,17,17,29],[2,1,,34,34,34,,34,34,34,,34,34,34,,34,34,34,,34,34,34,,34,34,34,,34,34,34,,34,,,,34,34,34,,34,34,34,,34,34,34,,34,34,34,,34,34,34,,34,34,34,,34,34,34,,34,,,],[6,1,,,36,,,,,,36,,36,,,,,,,,36,,,,,,36,,36,,,,,,,,36,,,,,,,,,,,,,,,,36,,,,,,36,,36,,,,,,],[3,1,,,,,25,,,,,,,,25,,,,,,,,25,,,,,,,,25,25,25,25,,,,,25,,,,,25,,,25,,,,,,,,25,,,,,,,,25,25,25,25]],[[1,-1,14,14,26,14,14,26,14,14,26,14,14,26,14,14,26,26,14,14,26,14,14,26,14,14,26,14,14,26,14,14,26,26,17,17,29,17,17,29,17,17,29,17,17,29,17,17,29,29,19,19,31,19,19,31,19,19,31,19,19,31,19,19,31,31],[4,1,24,24,,24,24,,24,24,24,24,,24,24,,24,,24,24,,24,24,,24,24,24,24,,24,24,,24,24,24,24,,24,24,,24,24,24,24,,24,24,,36,,24,24,,24,24,,24,24,24,24,,24,24,,24,24],[7,-1,14,,14,14,26,14,14,26,14,,14,14,26,14,14,26,14,,14,14,26,14,14,26,14,,14,14,26,14,14,26,17,,17,17,29,17,17,29,17,,17,17,29,17,17,29,19,,19,19,31,19,19,31,19,,19,19,31,19,19,31],[2,1,,36,36,36,,36,36,36,,36,36,36,,36,36,36,,36,36,36,,36,36,36,,36,36,36,,36,,,,36,36,36,,36,36,36,,36,36,36,,36,36,36,,36,36,36,,36,36,36,,36,36,36,,36,,,],[3,1,,,,,25,,,,,,,,25,,,,,,,,25,,,,,,,,25,25,25,25,,,,,25,,,,,,,,25,,,,,,,,25,,,,,,,,25,25,25,25],[6,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,34,,,,,,34,,34,,,,,,,,34,,,,,,34,,34,,,,,,]]],[0,1,1,2,3,4,4]]};playEffect(t){window.zzfx(...this.effects[t]??[])}playMusic(t){const e=window.zzfxM(...this.music[t]??[]);window.zzfxP(...e).loop=!0}stopMusic(){window.zzfxX.suspend(),this.musicNode?.stop(),this.musicNode?.disconnect()}}class E{source;loaded=!1;img;constructor(t){this.source=t,this.img=new Image}load(){return new Promise((t,e)=>{this.img.onload=()=>{this.loaded=!0,t()},this.img.onerror=t=>{e(t)},this.img.src=this.source})}}const R=document.getElementById("app");if(!R)throw new Error;const L=new class{scenes={};resources={};sprites={};emitter=new e;control;renderer;player;sound=new T;panel;startTime=0;s="intro0";sceneOrder=["intro0","intro1","intro2","level0"];constructor(e){this.renderer=new p(e),this.control=new t(e,this.emitter)}load(){return Promise.all(Object.values(this.resources).map(t=>t.load()))}get scene(){return this.scenes[this.s]}get order(){return this.sceneOrder.indexOf(this.s)}nextScene(){if(-1===this.order)return;const t=this.order+1;t>=this.sceneOrder.length||this.setScene(this.sceneOrder[t])}init(){return this.player=new c(new i(384,288),this),this.player.init(),this.control.init(),this.panel=new a(this),this.scenes={intro0:x(this),intro1:v(this),intro2:M(this),level0:P(this),gameover:D(this)},this.setScene(this.s),this.emitter.on("space",()=>{const t=this.scene;t&&(t.interactive||this.nextScene())}),Promise.resolve()}setScene(t){this.s=t,this.scene.game=this,this.renderer.scene=this.scene,this.scene.interactive&&(this.startTime=Date.now()),this.s.startsWith("level")&&this.sound.playMusic("main")}}(R);L.resources={furniture:new E("public/sprites/furniture.png"),interior:new E("public/sprites/interior.png"),cat:new E("public/sprites/cat.png"),ball:new E("public/sprites/ball.png"),rat:new E("public/sprites/rat.png"),granny:new E("public/sprites/granny.png"),fridge:new E("public/sprites/furniture/fridge.png"),kitchen:new E("public/sprites/furniture/kitchen.png"),window:new E("public/sprites/furniture/window.png"),tv:new E("public/sprites/furniture/tv.png"),table:new E("public/sprites/furniture/table.png"),plant:new E("public/sprites/furniture/plant.png"),chair:new E("public/sprites/furniture/chair.png"),chair2:new E("public/sprites/furniture/chair2.png"),door:new E("public/sprites/furniture/door.png"),shelf:new E("public/sprites/furniture/shelf.png"),wash:new E("public/sprites/furniture/wash.png"),stable:new E("public/sprites/furniture/small-table.png"),lamp:new E("public/sprites/furniture/lamp.png")},L.sprites={fridge:new n(L.resources.fridge,{fridge:[0,0,39,32]}),wash:new n(L.resources.wash,{wash:[0,0,16,16]}),kitchen:new n(L.resources.kitchen,{kitchen:[0,0,61,32]}),table:new n(L.resources.table,{table:[0,0,32,16]}),plant:new n(L.resources.plant,{plant:[0,0,8,12]}),window:new n(L.resources.window,{window:[0,0,16,32]}),chair:new n(L.resources.chair,{chair:[0,0,13,13]}),chair2:new n(L.resources.chair2,{chair2:[0,0,10,15]}),door:new n(L.resources.door,{door:[0,0,16,32]}),tv:new n(L.resources.tv,{tv:[0,0,32,16]}),shelf:new n(L.resources.shelf,{shelf:[0,0,31,16]}),stable:new n(L.resources.stable,{stable:[0,0,16,15]}),lamp:new n(L.resources.lamp,{lamp:[0,0,12,16]}),cat:new n(L.resources.cat,{idle:[2,8,10,10,4,6,250,!1],run:[2,40,10,10,4,6,200,!1],attack:[2,88,12,10,4,4,100,!0],death:[0,212,16,16,4,0,250,!0]}),ball:new n(L.resources.ball,{run:[0,0,32,32,4,0,200,!1]}),rat:new n(L.resources.rat,{run:[2,103,32,32,8,0,200,!1]}),granny:new n(L.resources.granny,{idle:[0,0,28,29,1,4,250,!1],run:[0,0,28,29,4,4,200,!1]})},L.load().then(()=>L.init()).then(()=>L.renderer.start());
